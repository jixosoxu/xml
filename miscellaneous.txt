Балансировка нагрузки

Планировщик

Round-robin



Нужен реестр настраиваемых системных лимитов:
1) Количество заявок обрабатываемых одним исполнителем
2) Количество экстренных заявок обрабатываемых одним исполнителем
3) Максимальное время ожидания обработки заявки
4) Максимальное время ожидания обработки экстренных заявок
5) Максимальное время ожидания подключения выбывшего исполнителя


Выбор сообщения для обработки:

1) Получаем наиболее раннее сообщение из сообщений в очереди выбывших исполнителей
2) Получаем наиболее раннее сообщение из сообщений в пометкой "срочное" в очереди новых сообщений
3) Получаем наиболее раннее сообщение из сообщений в очереди новых сообщений



Выбор исполнителя:

1) Получаем системные лимиты для исполнителей
2) Получаем активных исполнителей
3) Получаем список, обрабатываемых ими заявок
4) Сверяем лимиты с текущей загрузкой исполнителей
5) Если лимиты нагрузки испонителей не превышены, назначаем исполнителя
6) Иначе оставляем сообщение в очереди
7) Ожидаем освобождения исполнителя



Создание заявок:

1) От клиента приходит новое сообщение
2) Если нет прикрепленных данных, тогда создается новая заявка
3) Если есть прикрепленные данные:
3.1) данные о заявке не валидны - создается новая заявка
3.2) заявка существет, но закрыта - создается новая заявка с привязкой к закрытой
3.3) заявка не закрыта - сообщение прикрепляется к существующей заявке



Регистрация клиента:
1) Скачиваем приложение
2) Ввводим номер телефона
3) Вводим смс, полученный от системы
4) На следующем экране вводим email, имя
5) На указанный email приходит письмо со ссылкой подтвержения email'а
6) Пока переход по ссылке не осуществлен, в приложении email указан как неподтвержденный



Процесс логина/регистрации мобильного клиента (server side):
1) Получаем запрос кода авторизации
2) Отправляем код авторизации на указанный номер 3DS SMS
3) Получаем запрос авторизации
3.1) Если номер телефона присутствует в базе, тогда авторизуем пользователя, выдаем токен авторизации
3.2) Если это новый клиент, тогда производим первичную регистрацию, авторизуем пользователя, выдаем токен авторизации с пометкой "новый клиент"


Назначение исполнителя:
1) Приходит сообщение от пользователя
2) Система сохраняет сообщение
3) Система проверяет доступность текущего исполнителя
3.1) Если исполнитель доступен, перенаправляет ему сообщение
3.2) Если исполнитель недоступен/неназначен, тогда создает заявку в очереди на обслуживание
